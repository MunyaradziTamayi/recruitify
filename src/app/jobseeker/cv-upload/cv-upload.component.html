<div class="modal fade" id="uploadCvModal" tabindex="-1" aria-labelledby="uploadCvModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-dark text-white border-0">
                <h5 class="modal-title fw-bold" id="uploadCvModalLabel">
                    <i class="bi bi-file-earmark-arrow-up me-2"></i>Upload Your Resume
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
                    (click)="clearSelection()"></button>
            </div>
            <div class="modal-body p-4">
                <!-- Dropzone/File Input -->
                <div *ngIf="!isSuccess"
                    class="upload-zone p-5 border-2 border-dashed rounded-3 text-center mb-4 cursor-pointer"
                    [class.border-primary]="selectedFile" (click)="fileInput.click()">
                    <input type="file" #fileInput (change)="onFileSelected($event)" hidden accept=".pdf,.doc,.docx">
                    <div *ngIf="!selectedFile">
                        <i class="bi bi-cloud-arrow-up display-4 text-primary mb-3 d-block"></i>
                        <h6 class="fw-bold mb-1">Click to select or drag and drop</h6>
                        <p class="text-muted small mb-0">PDF, DOCX (Max 5MB)</p>
                    </div>
                    <div *ngIf="selectedFile">
                        <i class="bi bi-file-earmark-check display-4 text-success mb-3 d-block"></i>
                        <h6 class="fw-bold mb-1">{{ selectedFile.name }}</h6>
                        <p class="text-muted small mb-0">{{ (selectedFile.size / 1024).toFixed(0) }} KB</p>
                    </div>
                </div>

                <!-- Error Message -->
                <div *ngIf="error && !isSuccess" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <div>{{ error }}</div>
                </div>

                <!-- Extracted Data Preview (Optional) -->
                <div *ngIf="profile && !isLoading && !isSuccess" class="extracted-preview p-3 bg-light rounded-3 mb-4">
                    <h6 class="fw-bold mb-3 border-bottom pb-2">
                        <i class="bi bi-magic me-2"></i>Extracted Info
                    </h6>
                    <div class="row g-2 small">
                        <div class="col-4 text-muted">Name:</div>
                        <div class="col-8 fw-semibold">{{ profile.name }}</div>
                        <div class="col-4 text-muted">Email:</div>
                        <div class="col-8">{{ profile.email }}</div>
                        <div class="col-4 text-muted">Skills:</div>
                        <div class="col-8">
                            <span class="badge bg-secondary me-1" *ngFor="let skill of profile.skills.slice(0, 5)">{{
                                skill }}</span>
                            <span *ngIf="profile.skills.length > 5" class="text-muted">+{{ profile.skills.length - 5 }}
                                more</span>
                        </div>
                    </div>
                    <div class="alert alert-success mt-3 mb-0 py-2 small">
                        <i class="bi bi-check-circle me-1"></i> CV processed successfully!
                    </div>
                </div>

                <!-- Success Animation/Message -->
                <div *ngIf="isSuccess" class="text-center py-4">
                    <div class="success-checkmark mb-3">
                        <div class="check-icon">
                            <span class="icon-line line-tip"></span>
                            <span class="icon-line line-long"></span>
                            <div class="icon-circle"></div>
                            <div class="icon-fix"></div>
                        </div>
                    </div>
                    <h5 class="fw-bold text-success">Extraction Complete!</h5>
                    <p class="text-muted">Your profile has been updated with your CV details.</p>
                </div>

                <!-- Loading State -->
                <div *ngIf="isLoading" class="text-center py-4">
                    <div class="spinner-border text-primary mb-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mb-0">Extracting details from your CV...</p>
                </div>
            </div>
            <div class="modal-footer border-0 p-4 pt-0">
                <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal"
                    (click)="clearSelection()">{{ isSuccess ? 'Close' : 'Cancel' }}</button>
                <button type="button" class="btn btn-primary px-4"
                    [disabled]="!selectedFile || (isLoading && !isSuccess)" (click)="isSuccess ? null : uploadCV()"
                    [attr.data-bs-dismiss]="isSuccess ? 'modal' : null">
                    <span *ngIf="!isLoading && !isSuccess">Upload & Extract</span>
                    <span *ngIf="isLoading">Processing...</span>
                    <span *ngIf="isSuccess"><i class="bi bi-check-lg me-2"></i>Done</span>
                </button>
            </div>
        </div>
    </div>
</div>